CREATE OR REPLACE VIEW -- ok
q_cb_curr_escalation_rates AS
SELECT q_cb_active_months_res_qty.rep_month, q_cb_active_months_res_qty.pc, q_cb_active_months_res_qty.l_1, q_cb_active_months_res_qty.l_2, q_cb_active_months_res_qty.l_3, q_cb_active_months_res_qty.l_4, q_cb_active_months_res_qty.l_5, q_cb_active_months_res_qty.l_6, q_cb_active_months_res_qty.exp_cb_mon AS month, q_cb_active_months_res_qty.rs_l1, q_cb_active_months_res_qty.rs_l2, q_cb_active_months_res_qty.rs_l3,q_cb_active_months_res_qty.rs_l4, 
CASE WHEN (currency='try' AND w_inf_usd<>0) THEN 1+round(rt_usd_try*w_inf_usd,6) ELSE CASE WHEN (currency='eur' AND w_inf_usd<>0) THEN 1+round(rt_usd_eur*w_inf_usd,6) ELSE 1 END END AS k_usd, 
CASE WHEN (currency='try' AND w_inf_eur<>0) THEN 1+round(rt_eur_try*w_inf_eur,6) ELSE CASE WHEN (currency='usd' AND w_inf_eur<>0) THEN 1+round(rt_eur_usd*w_inf_eur,6) ELSE 1 END END AS k_eur, r4_code.w_inf_usd, r4_code.w_inf_eur, r4_code.currency AS rs_currency, q_cb_active_months_res_qty.key_r4_simple, q_cb_active_months_res_qty.key_full, q_cb_active_months_res_qty.key_r_pc_l6, q_cb_active_months_res_qty.key_r4, key_full || '.' || r4_code.currency || '.' || q_cb_active_months_res_qty.exp_cb_mon AS key_full_comb
FROM (q_cb_active_months_res_qty LEFT JOIN q_cb_monthly_curr_rates_inc ON (q_cb_active_months_res_qty.rep_month = q_cb_monthly_curr_rates_inc.rep_month) AND (q_cb_active_months_res_qty.pc = q_cb_monthly_curr_rates_inc.pc) AND (q_cb_active_months_res_qty.exp_cb_mon = q_cb_monthly_curr_rates_inc.exp_cb_mon)) LEFT JOIN r4_code ON q_cb_active_months_res_qty.key_r4_simple = r4_code.key_r4_simple ;
